/* Teleprompter (c) 2015 by David Schwarz */

var teleprompter=angular.module("teleprompter",["ui.router","ui.router.stateHelper"]);teleprompter.config(["stateHelperProvider","$urlRouterProvider",function(a,b){a.state({name:"root",url:"/",views:{main:{templateUrl:"/page/index.html",controller:"mainCtrl"}}}).state({name:"host",url:"/host",views:{main:{templateUrl:"/page/host.html",controller:"hostCtrl"}}}).state({name:"client",url:"/client",views:{main:{templateUrl:"/page/client.html",controller:"clientCtrl"}}}).state({name:"play",views:{main:{templateUrl:"/page/play.html",controller:"playCtrl"}}}).state({name:"err404",url:"/err404",views:{main:{templateUrl:"/page/404.html"}}}),b.when("","/"),b.otherwise("/err404")}]),teleprompter.run(["$state","socket",function(a,b){a.is("root")||(b.emit("isConnected"),b.on("isConntected",function(b){b||a.go("root")})),b.on("disconnect",function(){console.log("disconnected"),a.go("root")})}]),teleprompter.controller("clientCtrl",["$scope","$rootScope","$http","$window","$state","socket",function(a,b,c,d,e,f){function g(){f.emit("setResolution",{x:d.innerWidth,y:d.innerHeight})}g(),angular.element(d).on("resize",g),f.on("kick",function(){e.go("root")}),f.on("play",function(b){a.text=b})}]),teleprompter.controller("hostCtrl",["$scope","$rootScope","$state","$http","socket",function(a,b,c,d,e){a.roomId="n/a",e.emit("host"),e.on("host",function(b){a.$apply(function(){a.roomId=b[0]})}),b.$watch("text",function(){e.emit("setText",b.text)}),e.emit("updateClients"),e.on("client",function(b){a.$apply(function(){a.clients=b[0]})}),a.play=function(a,b){a.preventDefault(),e.emit("play",b),c.go("play")}}]),teleprompter.controller("mainCtrl",["$scope","$state","$window","socket",function(a,b,c,d){d.emit("disconnect",!0),a.$watch("roomId",function(){d.emit("join",{rid:a.roomId,resolution:{x:c.innerWidth,y:c.innerHeight}})}),d.on("join",function(a){b.go("client")})}]),teleprompter.controller("playCtrl",["$scope","$state","socket",function(a,b,c){c.emit("init"),c.on("kick",function(){b.go("host")})}]),teleprompter.directive("teleprompter",["socket",function(a){return{restrict:"AE",templateUrl:"/page/teleprompter.html",replace:!1,link:function(b,c,d){a.on("text",function(a){b.teleText=a})}}}]),teleprompter.factory("socket",[function(){var a=io.connect();return{on:function(b,c){a.on(b,function(){var a=arguments;c(a)})},emit:function(b,c,d){a.emit(b,c),d&&d.apply(a)}}}]);