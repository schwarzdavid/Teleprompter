/* Teleprompter (c) 2015 by David Schwarz */

var teleprompter=angular.module("teleprompter",["ui.router","ui.router.stateHelper"]);teleprompter.config(["stateHelperProvider","$urlRouterProvider",function(a,b){a.state({name:"root",url:"/",views:{main:{templateUrl:"/page/index.html",controller:"mainCtrl"}}}).state({name:"host",url:"/host",views:{main:{templateUrl:"/page/host.html",controller:"hostCtrl"}}}).state({name:"client",url:"/client",views:{main:{template:"Client bitch :@",controller:"clientCtrl"}}}).state({name:"err404",url:"/err404",views:{main:{templateUrl:"/page/404.html"}}}),b.when("","/"),b.otherwise("/err404")}]),teleprompter.controller("clientCtrl",["$scope","$rootScope","$http","$window","$state","socket",function(a,b,c,d,e,f){function g(){f.emit("setResolution",{x:d.innerWidth,y:d.innerHeight})}g(),angular.element(d).on("resize",g),f.on("disconnect",function(){console.log("disconnected"),e.go("root")}),f.on("kick",function(){console.log("kicked"),e.go("root")})}]),teleprompter.controller("hostCtrl",["$scope","$rootScope","$http","socket",function(a,b,c,d){a.roomId="n/a",d.emit("host"),d.on("host",function(b){a.$apply(function(){a.roomId=b[0]})}),a.$watch("text",function(){d.emit("setText",a.text)}),d.on("client",function(b){console.log(b[0]),a.$apply(function(){a.clients=b[0]})})}]),teleprompter.controller("mainCtrl",["$scope","$state","$window","socket",function(a,b,c,d){d.emit("disconnect",!0),a.$watch("roomId",function(){d.emit("join",{rid:a.roomId,resolution:{x:c.innerWidth,y:c.innerHeight}})}),d.on("join",function(a){b.go("client")})}]),teleprompter.factory("socket",[function(){var a=io.connect();return{on:function(b,c){a.on(b,function(){var a=arguments;c(a)})},emit:function(b,c,d){a.emit(b,c),d&&d.apply(a)}}}]);